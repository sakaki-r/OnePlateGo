<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>One Plate Go</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
  <style>
    .plate-container {
      background: url([[@{/images/plate.jpg}]]) no-repeat center/cover;
    }
  </style>
</head>

<body>
<div class="page-container">

  <!-- âœ… ãƒ˜ãƒƒãƒ€ãƒ¼å…¨ä½“ -->
  <div class="header-bar">
    <h1 class="site-title">çŒ®ç«‹ä½œæˆ</h1>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼‹ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ -->
    <div class="user-info" th:if="${#authorization.expression('isAuthenticated()')}">
      <span th:text="${#authentication.name + ' ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼'}"></span>
      <a th:href="@{/logout}" class="logout-link">ğŸ”“ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>

    <!-- æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼šãƒ­ã‚°ã‚¤ãƒ³ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ -->
    <div class="user-info" th:if="${not #authorization.expression('isAuthenticated()')}">
  <button class="show-login-btn">ğŸ”“ ãƒ­ã‚°ã‚¤ãƒ³</button>
</div>

  </div>

  <!-- âœ… ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒˆã‚°ãƒ«å¼ï¼‰ -->
  <div class="login-container" id="loginContainer" th:if="${not #authorization.expression('isAuthenticated()')}" style="display: none;">
    <h3>ãƒ­ã‚°ã‚¤ãƒ³</h3>
    <form th:action="@{/login}" method="post">
      <input type="text" name="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" required />
      <input type="password" name="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required />
      <button type="submit" class="loginbtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
      <p><a th:href="@{/register}" class="move">ä¼šå“¡ç™»éŒ²ã‚’ã”å¸Œæœ›ã®æ–¹ã¯ã“ã¡ã‚‰</a></p>
      <p th:if="${param.error}" style="color:red; font-size: 11px;">ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</p>
      <p th:if="${param.logout}" style="color:green; font-size: 11px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ</p>
    </form>
  </div>

  <!-- âœ… çŒ®ç«‹ä½œæˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
  <div class="home-layout">
    <div class="plate-container">
      <img id="cat-animation" src="/images/cat-back.png" alt="ã‚·ã‚§ãƒ•çŒ«" class="cat-chef-inside">

      <form class="input-area" action="/result" method="post" th:object="${mealRequest}">
        <p>ä½•äººåˆ†ï¼š<input id="input-meal" type="number" th:field="*{mealCount}" min="1" required></p>
        <p>è‚‰æ–™ç†ï¼š<input id="input-meat" type="number" th:field="*{meatCount}" min="0" required></p>
        <p>é­šæ–™ç†ï¼š<input id="input-fish" type="number" th:field="*{fishCount}" min="0" required></p>
        <p>ãã®ä»–ï¼š<input id="input-other" type="number" th:field="*{otherCount}" min="0" required></p>
        <p>åˆè¨ˆæ–™ç†æ•°ï¼š<span id="totalCount">0</span></p>
        <button type="submit">çŒ®ç«‹ã‚’ã¤ãã‚‹ï¼</button>
      </form>
    </div>
  </div>

</div>

<!-- âœ… JavaScript -->
<script>
  function updateTotal() {
    const meat = parseInt(document.querySelector('[name="meatCount"]').value || 0);
    const fish = parseInt(document.querySelector('[name="fishCount"]').value || 0);
    const other = parseInt(document.querySelector('[name="otherCount"]').value || 0);
    document.getElementById("totalCount").innerText = meat + fish + other;
    playCatAnimation();
  }

 
  function playCatAnimationLoop() {
    const catImg = document.getElementById("cat-animation");
    const frames = [
      "/images/cat-back.png",
      "/images/cat_front1.png",
      "/images/cat_front2.png",
      "/images/cat_front3.png"
    ];

    let i = 0;
    setInterval(() => {
      catImg.src = frames[i % frames.length];
      i++;
    }, 2500); // 2ç§’ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆ
  }

  window.addEventListener('DOMContentLoaded', () => {
    // å…¥åŠ›ç›£è¦–ï¼ˆå¿…è¦ãªã‚‰ï¼‰
    document.querySelectorAll('input[type="number"]').forEach(input => {
      input.addEventListener('input', updateTotal);
    });
    updateTotal();

    // çŒ«ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ç¶šã‘ã‚‹
    playCatAnimationLoop();
  });

  function updateTotal() {
    const meat = parseInt(document.querySelector('[name="meatCount"]').value || 0);
    const fish = parseInt(document.querySelector('[name="fishCount"]').value || 0);
    const other = parseInt(document.querySelector('[name="otherCount"]').value || 0);
    document.getElementById("totalCount").innerText = meat + fish + other;
  }


  window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('input[type="number"]').forEach(input => {
      input.addEventListener('input', updateTotal);
    });
    updateTotal();

    // âœ… ãƒˆã‚°ãƒ«å¼ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
    const loginBtn = document.querySelector(".show-login-btn");
    const loginForm = document.getElementById("loginContainer");
    if (loginBtn && loginForm) {
      loginBtn.addEventListener("click", () => {
        const isHidden = loginForm.style.display === "none";
        loginForm.style.display = isHidden ? "block" : "none";
        loginBtn.textContent = isHidden ? "âœ–ï¸ é–‰ã˜ã‚‹" : "ğŸ”“ ãƒ­ã‚°ã‚¤ãƒ³";
      });
    }
  });
</script>
</body>
<footer class="footer-nav">
  <a href="/" class="fotterbtn">ğŸ½ï¸HOME</a>
  <p class="copyright">Â© One Plate Go</p>
</footer>
</html>
